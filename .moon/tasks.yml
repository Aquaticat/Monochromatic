$schema: 'https://moonrepo.dev/schemas/tasks.json'

implicitInputs:
- '@group(configs)'
- '@group(sources)'

fileGroups:
  configs:
  - '*.config.{cjs,mjs,ts}'
  - '*.{json,jsonc,yaml,yml}'
  - '/packages/config/*'
  - '/packages/config/src/**/*'
  - '/packages/config/dist/**/*'
  sources:
  - 'src/**/*.{ts,astro,html,vue,mjs,js,cjs}'
  unitTests:
  - 'src/**/*.unit.test.ts'
  browserTests:
  - 'src/**/*.browser.test.ts'
  tests:
  - 'src/**/*.test.ts'
  benchs:
  - 'src/**/*.bench.ts'
  dists:
  - 'dist/**/*'
  allPackages:
  - '/packages/*/*/*/**/*'
  allSources:
  - '/packages/*/*/src/**/*.{ts,astro,html,vue,mjs,js,cjs}'
  allUnitTests:
  - '/packages/*/*/src/**/*.unit.test.ts'
  allBrowserTests:
  - '/packages/*/*/src/**/*.browser.test.ts'
  allTests:
  - '/packages/*/*/src/**/*.test.ts'
  allBenchs:
  - '/packages/*/*/src/**/*.bench.ts'
  allDists:
  - '/packages/*/*/dist/**/*'

tasks:
  types:
    command: 'tsc --build --force --verbose'
    options:
      outputStyle: 'buffer-only-failure'

  typesWatch:
    command: 'tsc --watch'
    local: true

  js_default:
    command: 'vite build --config vite.config.ts --mode production'
    deps:
      - 'vite:js'
    options:
      outputStyle: 'buffer-only-failure'

  js_defaultWatch:
    command: 'vite build --config vite.config.ts --mode production --watch'
    local: true

  js:
    deps:
    - js_default
    options:
      outputStyle: 'buffer-only-failure'

  jsWatch:
    deps:
    - js_defaultWatch
    local: true

#  "w:types": "tsc --watch",
#  "b:types": "tsc --build --force --verbose",
#  "b:js_node": "vite build --config vite.config.ts --mode production,node",
#  "w:js_node": "vite build --config vite.config.ts --mode production,node --watch",
#  "b:js_browser": "vite build --config vite.config.ts --mode production,browser",
#  "w:js_browser": "vite build --config vite.config.ts --mode production,browser --watch",
#  "b": "pnpm run --stream \"/^b:\\w+$/\"",
#  "w": "pnpm run --stream \"/^w:\\w+$/\""
