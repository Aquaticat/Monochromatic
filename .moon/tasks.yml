$schema: 'https://moonrepo.dev/schemas/tasks.json'

implicitInputs:
- '@group(configs)'
- '@group(sources)'

implicitDeps:
  # Used extensively throughout the repo
  - 'es:js'

fileGroups:
  configs:
  - '*.config.{cjs,mjs,ts}'
  - '*.{json,jsonc,yaml,yml}'
  sources:
  - 'src/**/*.{ts,astro,html,vue,mjs,js,cjs}'
  unitTests:
  - 'src/**/*.unit.test.ts'
  browserTests:
  - 'src/**/*.browser.test.ts'
  tests:
  - 'src/**/*.test.ts'
  benchs:
  - 'src/**/*.bench.ts'
  dists:
  - 'dist/**/*'
  distJs:
  - 'dist/final/js/**/*'
  distTypes:
  - 'dist/final/types/**/*'
  distMastra:
  - '.mastra/**/*'
  allDistTypes:
  - '/packages/*/*/dist/final/types/**/*'
  allDistJs:
  - '/packages/*/*/dist/final/js/**/*'
  allDistMastra:
  - '/packages/*/*/.mastra/**/*'
  allPackages:
  - '/packages/*/*/*/**/*'
  allSources:
  - '/packages/*/*/src/**/*.{ts,astro,html,vue,mjs,js,cjs}'
  allUnitTests:
  - '/packages/*/*/src/**/*.unit.test.ts'
  allBrowserTests:
  - '/packages/*/*/src/**/*.browser.test.ts'
  allTests:
  - '/packages/*/*/src/**/*.test.ts'
  allBenchs:
  - '/packages/*/*/src/**/*.bench.ts'
  allDists:
  - '/packages/*/*/dist/final/**/*'

taskOptions:
  inferInputs: false
  mergeArgs: replace
  mergeInputs: replace
  mergeOutputs: replace
  outputStyle: buffer-only-failure
  timeout: 30

tasks:
  _shell:
    options:
      unixShell: 'bash'
      windowsShell: 'bash'
      shell: true

  js_default:
    command: 'vite build --config vite.config.ts --mode production'
    outputs:
    - '@group(distJs)'
    options:
      outputStyle: 'buffer-only-failure'

  js_defaultWatch:
    command: 'vite build --config vite.config.ts --mode production --watch'
    preset: 'server'

  js:
    deps:
    - js_default
    outputs:
    - '@group(distJs)'
    options:
      outputStyle: 'buffer-only-failure'

  jsWatch:
    deps:
    - js_defaultWatch
    preset: 'server'
