const header=document.querySelector("header"),footer=document.querySelector("footer"),addCSS=css=>document.head.appendChild(document.createElement("style")).innerHTML=css;addCSS(`main {
  min-block-size: calc(100dvb - ${window.getComputedStyle(header).getPropertyValue("block-size")} - ${window.getComputedStyle(footer).getPropertyValue("block-size")});
}`);document.querySelectorAll("details").forEach(details=>{details.addEventListener("toggle",()=>{if(details.hasAttribute("open")){let parentDetails;do parentDetails=details.parentElement.closest("details:not([open])"),parentDetails&&(parentDetails.open=!0);while(parentDetails!==null)}})});const q=new URLSearchParams(location.search).get("q");q&&(location.href=`https://duckduckgo.com/?q=${encodeURIComponent(q)}+${encodeURIComponent(`site:${location.origin}`)}`);function isLang(str){return str.length===2&&/^[a-z]+$/.test(str)||str.length===5&&/^[a-z]{2}-[A-Z]{2}$/.test(str)}const langMappings=[{codes:["en","en-US","en-CA","en-UK"],path:""},{codes:["zh","zh-CN","zh-TW"],path:"zh"}],I18N=new Map(langMappings.flatMap(langMapping=>langMapping.codes.map(key=>[key,langMapping.path]))),LANG_PATHS=langMappings.map(langMapping=>langMapping.path),STRINGS=new Map([["404",new Map([["en","You've landed on an unknown page."],["zh","未知领域"]])],["tempUnavailable",new Map([["en","Sorry, this page is not available in your language yet. Please check back later."],["zh","抱歉，此页暂时无所选语言的版本，请稍后再看。"]])],["unsupported",new Map([["en","Sorry, this site is not available in your language."],["zh","抱歉，此网站不支持所选语言。"]])],["searchPlaceholder",new Map([["en","Search tags, topics, or snippets"],["zh","搜索关键词，话题，或文段"]])]]),DEFAULT_LANG=langMappings.find(langMapping=>langMapping.path==="").codes[0],exists=async url=>fetch(url).then(response=>response.ok).catch(()=>!1),trimEndWith=(str,trimmer)=>{const reversedTrimmer=trimmer.split("").toReversed().join();let modifingString=str;for(;modifingString.endsWith(trimmer);)modifingString=modifingString.split("").toReversed().join("").replace(reversedTrimmer,"").split("").toReversed().join("");return modifingString},filterPromise=(values,fn)=>Promise.all(values.map(fn)).then(booleans=>values.filter((_,i)=>booleans[i])),i18nStr=id=>{const firstLang=navigator.languages.find(lang=>STRINGS.get(id).has(lang));return STRINGS.get(id).get(firstLang||DEFAULT_LANG)},potentialCode=location.pathname.split("/")[1],isPotentialCodeLang=isLang(potentialCode);if(document.head.querySelector('meta[name="title"]').getAttribute("content")==="404"){const p=document.querySelector("main p");if(isPotentialCodeLang)if(LANG_PATHS.includes(potentialCode)){const existing=await filterPromise(LANG_PATHS.map(langPath=>`${location.origin}/${langPath}${location.pathname.split("/").slice(2).join("/")}`),exists);p.textContent=i18nStr("tempUnavailable"),console.log(`Sorry, this page isn't available in the language ${potentialCode} yet, please check back later.
      Meanwhile you can check out this page in ${existing}`)}else p.textContent=i18nStr("unsupported"),console.log(`Sorry, this site doesn't support the language ${potentialCode}`);else document.querySelector("main p").textContent=i18nStr("404")}else if(!sessionStorage.getItem("redirectedByLangMatching")&&!isPotentialCodeLang){const existing=await filterPromise(LANG_PATHS.map(langPath=>trimEndWith(`${location.origin}/${langPath}${location.pathname}`,"/")),exists),firstLang=navigator.languages.find(lang=>I18N.has(lang)&&existing.includes(trimEndWith(`${location.origin}/${I18N.get(lang)}${location.pathname}`,"/")));if(firstLang!==void 0){const i18nPath=I18N.get(firstLang);i18nPath!==potentialCode&&(console.log(`Your lang ${firstLang} is available!
        Redirecting to ${trimEndWith(`${location.origin}/${i18nPath}${location.pathname}`,"/")}`),sessionStorage.setItem("redirectedByLangMatching","true"),location.href=trimEndWith(`${location.origin}/${i18nPath}${location.pathname}`,"/"))}}const autoFocus=()=>HTMLElement.prototype.hasOwnProperty("autofocus");autoFocus||document.querySelector("#search").addEventListener("toggle",event=>{event.newState==="open"&&document.querySelector('input[name="q"]').focus()});
