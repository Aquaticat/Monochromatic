const prefetchedUrls=new Set,listenedAnchors=new WeakSet;let prefetchAll,defaultStrategy="viewport",inited=!1;function init(defaultOpts){inited||(inited=!0,prefetchAll??=defaultOpts?.prefetchAll??!1,defaultStrategy??=defaultOpts?.defaultStrategy??"hover",initTapStrategy(),initHoverStrategy(),initViewportStrategy(),initLoadStrategy())}function initTapStrategy(){for(const event of["touchstart","mousedown"])document.body.addEventListener(event,e=>{elMatchesStrategy(e.target,"tap")&&prefetch(e.target.href,{with:"fetch",ignoreSlowConnection:!0})},{passive:!0})}function initHoverStrategy(){let timeout;document.body.addEventListener("focusin",e=>{elMatchesStrategy(e.target,"hover")&&handleHoverIn(e)},{passive:!0}),document.body.addEventListener("focusout",handleHoverOut,{passive:!0}),onPageLoad(()=>{for(const anchor of document.getElementsByTagName("a"))listenedAnchors.has(anchor)||elMatchesStrategy(anchor,"hover")&&(listenedAnchors.add(anchor),anchor.addEventListener("mouseenter",handleHoverIn,{passive:!0}),anchor.addEventListener("mouseleave",handleHoverOut,{passive:!0}))});function handleHoverIn(e){const href=e.target.href;timeout&&clearTimeout(timeout),timeout=setTimeout(()=>{prefetch(href,{with:"fetch"})},80)}function handleHoverOut(){timeout&&(clearTimeout(timeout),timeout=0)}}function initViewportStrategy(){let observer;onPageLoad(()=>{for(const anchor of document.getElementsByTagName("a"))listenedAnchors.has(anchor)||elMatchesStrategy(anchor,"viewport")&&(listenedAnchors.add(anchor),observer??=createViewportIntersectionObserver(),observer.observe(anchor))})}function createViewportIntersectionObserver(){const timeouts=new WeakMap;return new IntersectionObserver((entries,observer)=>{for(const entry of entries){const anchor=entry.target,timeout=timeouts.get(anchor);entry.isIntersecting?(timeout&&clearTimeout(timeout),timeouts.set(anchor,setTimeout(()=>{observer.unobserve(anchor),timeouts.delete(anchor),prefetch(anchor.href,{with:"link"})},300))):timeout&&(clearTimeout(timeout),timeouts.delete(anchor))}})}function initLoadStrategy(){onPageLoad(()=>{for(const anchor of document.getElementsByTagName("a"))elMatchesStrategy(anchor,"load")&&prefetch(anchor.href,{with:"link"})})}function prefetch(url,opts){const ignoreSlowConnection=opts?.ignoreSlowConnection??!1;if(!canPrefetchUrl(url,ignoreSlowConnection))return;if(prefetchedUrls.add(url),(opts?.with??"link")==="link"){const link=document.createElement("link");link.rel="prefetch",link.setAttribute("href",url),document.head.append(link)}else fetch(url).catch(e=>{console.log(`[astro] Failed to prefetch ${url}`),console.error(e)})}function canPrefetchUrl(url,ignoreSlowConnection){if(!navigator.onLine||!ignoreSlowConnection&&isSlowConnection())return!1;try{const urlObj=new URL(url,location.href);return location.origin===urlObj.origin&&(location.pathname!==urlObj.pathname||location.search!==urlObj.search)&&!prefetchedUrls.has(url)}catch{}return!1}function elMatchesStrategy(el,strategy){if(el?.tagName!=="A")return!1;const attrValue=el.dataset.astroPrefetch;return attrValue==="false"?!1:strategy==="tap"&&(attrValue!=null||prefetchAll)&&isSlowConnection()?!0:attrValue==null&&prefetchAll||attrValue===""?strategy===defaultStrategy:attrValue===strategy}function isSlowConnection(){if("connection"in navigator){const conn=navigator.connection;return conn.saveData||/2g/.test(conn.effectiveType)}return!1}function onPageLoad(cb){cb();let firstLoad=!1;document.addEventListener("astro:page-load",()=>{if(!firstLoad){firstLoad=!0;return}cb()})}init();
